
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Operations &#8212; Cubed</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=f36352c5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'operations';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Computation" href="computation.html" />
    <link rel="prev" title="Design" href="design.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/cubed-logo.svg" class="logo__image only-light" alt="Cubed - Home"/>
    <script>document.write(`<img src="_static/cubed-logo.svg" class="logo__image only-dark" alt="Cubed - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">For users</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="user-guide/index.html">User Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="user-guide/executors.html">Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/storage.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/memory.html">Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/reliability.html">Reliability</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/scaling.html">Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide/gpus.html">GPU Support</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="examples/index.html">Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/how-to-run.html">How to run</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/basic-array-ops.html">Basic array operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/zarr.html">Zarr</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/xarray.html">Xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/rechunking.html">Rechunking</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/icechunk.html">Icechunk</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/pangeo.html">Pangeo</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Array.html">cubed.Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Array.compute.html">cubed.Array.compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Array.rechunk.html">cubed.Array.rechunk</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Array.visualize.html">cubed.Array.visualize</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.compute.html">cubed.compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.visualize.html">cubed.visualize</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.from_array.html">cubed.from_array</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.from_zarr.html">cubed.from_zarr</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.store.html">cubed.store</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.to_zarr.html">cubed.to_zarr</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.apply_gufunc.html">cubed.apply_gufunc</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.map_blocks.html">cubed.map_blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.map_overlap.html">cubed.map_overlap</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.rechunk.html">cubed.rechunk</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.nanmean.html">cubed.nanmean</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.nansum.html">cubed.nansum</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.pad.html">cubed.pad</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.random.random.html">cubed.random.random</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Callback.html">cubed.Callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.Spec.html">cubed.Spec</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.TaskEndEvent.html">cubed.TaskEndEvent</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/cubed.measure_reserved_mem.html">cubed.measure_reserved_mem</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="array-api.html">Python Array API</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="why-cubed.html">Why Cubed?</a></li>
<li class="toctree-l1"><a class="reference internal" href="related-projects.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles.html">Articles and Presentations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="computation.html">Computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cubed-dev/cubed" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cubed-dev/cubed/edit/main/operations.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cubed-dev/cubed/issues/new?title=Issue%20on%20page%20%2Foperations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Operations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-tree">Dependency Tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#elemwise"><code class="docutils literal notranslate"><span class="pre">elemwise</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-blocks"><code class="docutils literal notranslate"><span class="pre">map_blocks</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-selection"><code class="docutils literal notranslate"><span class="pre">map_selection</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#blockwise"><code class="docutils literal notranslate"><span class="pre">blockwise</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk"><code class="docutils literal notranslate"><span class="pre">rechunk</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-and-arg-reduction"><code class="docutils literal notranslate"><span class="pre">reduction</span></code> and <code class="docutils literal notranslate"><span class="pre">arg_reduction</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="operations">
<h1>Operations<a class="headerlink" href="#operations" title="Link to this heading">#</a></h1>
<p>Here we look in more depth at the core and primitive operations in Cubed.</p>
<section id="dependency-tree">
<h2>Dependency Tree<a class="headerlink" href="#dependency-tree" title="Link to this heading">#</a></h2>
<p>The following diagram shows the dependencies between operations. Array API functions are shown at the top (in white), the core operations are in the middle (in orange), and the primitive operations are at the bottom (<code class="docutils literal notranslate"><span class="pre">blockwise</span></code> in pink and <code class="docutils literal notranslate"><span class="pre">rechunk</span></code> in green). Not all Array API functions are shown, just a representative selection.</p>
<p><img alt="Operations dependency tree" src="_images/ops.dot.svg" /></p>
<p>Note how fundamental <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> is - all array API functions depend on it.</p>
</section>
<section id="elemwise">
<span id="elemwise-operation"></span><h2><code class="docutils literal notranslate"><span class="pre">elemwise</span></code><a class="headerlink" href="#elemwise" title="Link to this heading">#</a></h2>
<p>The simplest core operation is <code class="docutils literal notranslate"><span class="pre">elemwise</span></code>, which maps input array elements to output array elements, a block at a time.</p>
<ul class="simple">
<li><p>Preserves: <code class="docutils literal notranslate"><span class="pre">shape</span></code>, <code class="docutils literal notranslate"><span class="pre">chunks</span></code>, <code class="docutils literal notranslate"><span class="pre">numblocks</span></code></p></li>
<li><p><strong>Multiple</strong> inputs, <strong>single</strong> output</p></li>
</ul>
<p>It is a core operation that is implemented using <code class="docutils literal notranslate"><span class="pre">blockwise</span></code>.</p>
<p>Here’s an example with two inputs, such as for <code class="docutils literal notranslate"><span class="pre">add</span></code>. (Arrows are only shown for two input blocks, in order to avoid cluttering the diagram.)</p>
<p><img alt="The elemwise core operation" src="_images/elemwise.svg" /></p>
<p>(Note that <code class="docutils literal notranslate"><span class="pre">elemwise</span></code> supports broadcasting, but that is not shown here.)</p>
</section>
<section id="map-blocks">
<h2><code class="docutils literal notranslate"><span class="pre">map_blocks</span></code><a class="headerlink" href="#map-blocks" title="Link to this heading">#</a></h2>
<p>Like <code class="docutils literal notranslate"><span class="pre">elemwise</span></code>, <code class="docutils literal notranslate"><span class="pre">map_blocks</span></code> operates on corresponding input blocks, but they need not match in shape, and the output block shape may differ too.</p>
<ul class="simple">
<li><p>Preserves: <code class="docutils literal notranslate"><span class="pre">numblocks</span></code></p></li>
<li><p><strong>Multiple</strong> inputs, <strong>single</strong> output</p></li>
</ul>
<p>It is a core operation that is implemented using <code class="docutils literal notranslate"><span class="pre">blockwise</span></code>.</p>
<p>This example shows how the <code class="docutils literal notranslate"><span class="pre">squeeze</span></code> operation is implemented using <code class="docutils literal notranslate"><span class="pre">map_blocks</span></code> (with a single input). Note that although the number of blocks is preserved, the shape and chunk size of the output is different to the input since the second dimension is dropped.</p>
<p><img alt="The map_blocks core operation" src="_images/map_blocks.svg" /></p>
</section>
<section id="map-selection">
<h2><code class="docutils literal notranslate"><span class="pre">map_selection</span></code><a class="headerlink" href="#map-selection" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">map_selection</span></code> operation selects subsets of an input array using standard NumPy indexing notation.</p>
<ul class="simple">
<li><p>No input array attributes are preserved in general</p></li>
<li><p><strong>Single</strong> input, <strong>single</strong> output</p></li>
</ul>
<p>It is a core operation that is implemented using <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> on the output’s blocks. It works by converting indexing selections, such as slices, to keys that refer to blocks in the input array, then retrieving these blocks, slicing them, and assembling them into the final output block.</p>
<p>This example shows how <code class="docutils literal notranslate"><span class="pre">index</span></code> is implemented using <code class="docutils literal notranslate"><span class="pre">map_selection</span></code>. Each block in the output array is read directly from one or more blocks from the inputs.</p>
<p><img alt="The map_selection core operation" src="_images/map_selection.svg" /></p>
<p>Note: previously, operations that now use <code class="docutils literal notranslate"><span class="pre">map_selection</span></code> were written using <code class="docutils literal notranslate"><span class="pre">map_direct</span></code>, which allowed input arrays to be read directly. The main difference between the two operations is that <code class="docutils literal notranslate"><span class="pre">map_selection</span></code> tracks which blocks are read by the operation, which allows the optimizer to fuse operations. This is unlike <code class="docutils literal notranslate"><span class="pre">map_direct</span></code>, which does not provide information about block inputs, and therefore cannot be fused by the optimizer.</p>
</section>
<section id="blockwise">
<h2><code class="docutils literal notranslate"><span class="pre">blockwise</span></code><a class="headerlink" href="#blockwise" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> operation is a primitive operation that operates on input array blocks, while allowing an input block to be sent to multiple output blocks.</p>
<ul class="simple">
<li><p>No input array attributes are preserved in general</p></li>
<li><p><strong>Multiple</strong> inputs, <strong>single</strong> output</p></li>
</ul>
<p>This example shows how <code class="docutils literal notranslate"><span class="pre">outer</span></code> is implemented using <code class="docutils literal notranslate"><span class="pre">blockwise</span></code>. Each block from the input is sent to three blocks in the output. (Arrows are only shown for two input blocks, in order to avoid cluttering the diagram.)</p>
<p><img alt="The blockwise primitive operation" src="_images/blockwise.svg" /></p>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">general_blockwise</span></code> operation is a more general form of <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> that uses a function to specify the block mapping, rather than an index notation, and which supports multiple outputs.</p>
<ul class="simple">
<li><p>No input array attributes are preserved in general</p></li>
<li><p><strong>Multiple</strong> inputs, <strong>multiple</strong> outputs</p></li>
</ul>
<p>For multiple outputs, all output arrays must have matching <code class="docutils literal notranslate"><span class="pre">numblocks</span></code>.</p>
</section>
<section id="rechunk">
<span id="rechunk-operation"></span><h2><code class="docutils literal notranslate"><span class="pre">rechunk</span></code><a class="headerlink" href="#rechunk" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rechunk</span></code> operation is a primitive operation for changing the chunking of an array, without changing its shape or dtype.</p>
<ul class="simple">
<li><p>Preserves: <code class="docutils literal notranslate"><span class="pre">shape</span></code>, <code class="docutils literal notranslate"><span class="pre">dtype</span></code></p></li>
<li><p><strong>Single</strong> input, <strong>single</strong> output</p></li>
</ul>
<p>This example shows how there is no one-to-one correspondence between blocks in the input and output. In general, an output block is composed of parts of many input blocks. Consult <a class="reference external" href="https://rechunker.readthedocs.io/en/latest/algorithm.html">this page on the rechunker algorithm</a> for details of how it is implemented.</p>
<p><img alt="The rechunk primitive operation" src="_images/rechunk.svg" /></p>
</section>
<section id="reduction-and-arg-reduction">
<h2><code class="docutils literal notranslate"><span class="pre">reduction</span></code> and <code class="docutils literal notranslate"><span class="pre">arg_reduction</span></code><a class="headerlink" href="#reduction-and-arg-reduction" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">reduction</span></code> operation reduces an array along one or more axes.</p>
<ul class="simple">
<li><p>No input array attributes are preserved in general</p></li>
<li><p><strong>Single</strong> input, <strong>single</strong> output</p></li>
</ul>
<p>It is a core operation that is implemented using a <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> operation called <code class="docutils literal notranslate"><span class="pre">partial_reduce</span></code> that reads multiple blocks and performs the reduction operation on them.
The <code class="docutils literal notranslate"><span class="pre">partial_reduce</span></code> operations are arranged in a tree (<code class="docutils literal notranslate"><span class="pre">tree_reduce</span></code>) with multiple rounds until there’s a single block in each reduction axis. Finally an aggregate <code class="docutils literal notranslate"><span class="pre">blockwise</span></code> operation is applied to the results.</p>
<p>Here is an example of reducing over the first axis, with two rounds of <code class="docutils literal notranslate"><span class="pre">partial_reduce</span></code> operations:</p>
<p><img alt="The reduction core operation" src="_images/reduction_new.svg" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">arg_reduction</span></code> works similarly, but uses different functions to return indexes rather than values.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="design.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Design</p>
      </div>
    </a>
    <a class="right-next"
       href="computation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Computation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-tree">Dependency Tree</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#elemwise"><code class="docutils literal notranslate"><span class="pre">elemwise</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-blocks"><code class="docutils literal notranslate"><span class="pre">map_blocks</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-selection"><code class="docutils literal notranslate"><span class="pre">map_selection</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#blockwise"><code class="docutils literal notranslate"><span class="pre">blockwise</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rechunk"><code class="docutils literal notranslate"><span class="pre">rechunk</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-and-arg-reduction"><code class="docutils literal notranslate"><span class="pre">reduction</span></code> and <code class="docutils literal notranslate"><span class="pre">arg_reduction</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cubed contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>